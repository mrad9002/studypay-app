<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StudyPay - Get Paid to Study</title>
    <style>
        body { font-family: Arial; text-align: center; background: #f0f8ff; padding: 20px; }
        h1 { color: #2c3e50; }
        input, textarea { padding: 10px; margin: 10px; font-size: 18px; width: 80%; }
        button { padding: 10px; font-size: 18px; }
        .question { margin: 20px; text-align: left; background: white; padding: 15px; border-radius: 10px; }
        #markscheme { display: none; background: #e8f5e9; padding: 15px; border-radius: 10px; }
        #result { margin: 20px; font-size: 24px; font-weight: bold; }
        .earn { color: green; }
    </style>
</head>
<body>
    <h1>StudyPay ðŸ’°</h1>
    <p>Enter your details to generate a custom question paper. Complete it to earn from challenges (stake via bKash/PromptPay, high scorers win pot). Agree to <a href="[paste your Google Doc terms link here]" target="_blank">Terms</a> (fees apply).</p>

    <textarea id="syllabus" placeholder="My syllabus is (e.g., Cambridge IGCSE Math 0580 2024)" rows="3"></textarea><br>
    <input id="grade" placeholder="I am from grade (e.g., 10)" type="text"><br>
    <input id="subject" placeholder="Subject (e.g., Mathematics)" type="text"><br>
    <input id="topic" placeholder="Topic (e.g., Algebra)" type="text"><br>

    <button onclick="generatePaper()">Generate Question Paper</button>

    <div id="paper"></div>
    <div id="markscheme"></div>
    <div id="result"></div>

    <footer>
        <p>Made by Mahir. WhatsApp [your number] for challenge details.</p>
    </footer>

    <script>
        async function generatePaper() {
            const syllabus = document.getElementById("syllabus").value;
            const grade = document.getElementById("grade").value;
            const subject = document.getElementById("subject").value;
            const topic = document.getElementById("topic").value;
            if (!syllabus || !grade || !subject || !topic) {
                alert("Fill all fields!");
                return;
            }

            const response = await fetch('/generate-questions', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ syllabus, grade, subject, topic })
            });
            const paper = await response.json();

            let paperHTML = `<h2>${paper.title}</h2><p>Answer all. Submit to see mark scheme.</p>`;
            window.currentPaper = paper;
            paper.questions.forEach((qst, i) => {
                paperHTML += `<div class="question">
                    <p><strong>Q${qst.number}:</strong> ${qst.text} (${qst.marks} marks)</p>
                    ${qst.type === 'mcq' ? qst.options.map(opt => `<input type="radio" name="q${i}" value="${opt}"> ${opt}<br>`).join('') : ''}
                    <textarea rows="3" placeholder="Your answer" id="ans${i}"></textarea>
                </div>`;
            });
            paperHTML += `<button onclick="submitPaper()">Submit Answers</button>`;
            document.getElementById("paper").innerHTML = paperHTML;
            document.getElementById("markscheme").style.display = "none";
            document.getElementById("result").innerHTML = "";
        }

        function submitPaper() {
            let totalMarks = 0;
            let obtained = 0;
            let schemeHTML = "<h2>Mark Scheme</h2>";

            window.currentPaper.questions.forEach((qst, i) => {
                let userAns = document.getElementById(`ans${i}`).value.trim().toLowerCase();
                let correct = qst.answer.toLowerCase();
                let correctMark = userAns.includes(correct) ? qst.marks : 0; // Simple match
                obtained += correctMark;
                totalMarks += qst.marks;

                schemeHTML += `<div class="question">
                    <p><strong>Q${qst.number}:</strong> ${qst.text}</p>
                    <p><strong>Answer:</strong> ${qst.answer}</p>
                    <p><strong>Mark Scheme:</strong> ${qst.markscheme}</p>
                    <p>Your answer: ${userAns || "No answer"}</p>
                    <p style="color:${correctMark ? 'green' : 'red'}">You got ${correctMark}/${qst.marks}</p>
                </div>`;
            });

            let percentage = (obtained / totalMarks) * 100;
            let resultHTML = `<div>You scored ${percentage.toFixed(0)}% (${obtained}/${totalMarks})</div>`;

            if (percentage >= 70) {
                resultHTML += `<div class="earn">ðŸŽ‰ You won! Message for pot claim (terms apply).</div>`;
            } else {
                resultHTML += `<div>Keep practicing!</div>`;
            }

            document.getElementById("markscheme").innerHTML = schemeHTML;
            document.getElementById("markscheme").style.display = "block";
            document.getElementById("result").innerHTML = resultHTML;
        }
    </script>
</body>
</html>
